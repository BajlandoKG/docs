<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="description" content="Vanilla Forums, create an online community that your customers will love">
        <meta name="author" content="Vanilla Community">

        <title>Vanilla Forums Documentation</title>

        <link href="//docs.vanillaforums.com/css/docs.css" rel="stylesheet">
        <link href="//docs.vanillaforums.com/css/fonts/fontawesome/css/font-awesome.min.css" rel="stylesheet">
        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/styles/default.min.css">

        <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script>
        <script src="//docs.vanillaforums.com/js/vendor/jquery-3.0.0.min.js"></script>
        <script src="//docs.vanillaforums.com/js/vendor/jquery.store.js"></script>
        <script src="//docs.vanillaforums.com/js/lunr-index.json" id="search-manifest" type="application/json"></script>
        <script src="//docs.vanillaforums.com/js/vendor/lunr.js"></script>
        <script src="//docs.vanillaforums.com/js/search.js"></script>

        <link rel="shortcut icon" href="//docs.vanillaforums.com/favicon.ico" type="image/x-icon" />
        <link rel="apple-touch-icon" href="//docs.vanillaforums.com/apple-touch-icon.png" />
        <style type="text/css">
            .callout {
                table-layout: fixed;
            }
        </style>

        
<script type="text/javascript">
    (function(i, s, o, g, r, a, m) {
        i['GoogleAnalyticsObject'] = r;
        i[r] = i[r] || function() {
            (i[r].q = i[r].q || []).push(arguments)
        }, i[r].l = 1 * new Date();
        a = s.createElement(o),
                m = s.getElementsByTagName(o)[0];
        a.async = 1;
        a.src = g;
        m.parentNode.insertBefore(a, m)
    })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

    ga('create', 'UA-12713112-1', 'auto');
    ga('require', 'displayfeatures');
    ga('send', 'pageview');
</script>

<script type="text/javascript">
    (function(d, s, i, r) {
        if (d.getElementById(i)) {
            return;
        }
        var n = d.createElement(s), e = d.getElementsByTagName(s)[0];
n.id = i;
        n.src = '//js.hs-analytics.net/analytics/' + (Math.ceil(new Date() / r) * r) + '/95135.js';
        e.parentNode.insertBefore(n, e);
    })(document, "script", "hs-analytics", 300000);
</script>

    </head>

    <body class="docs grid docs-layout-single docs-layout-section-developer">

        <header class="docs-header">
    
    <div class="row">

        <div class="column column-4">
            
            <a class="vertical-group docs-header-logo" href="//docs.vanillaforums.com/">
                <img class="logo" src="//docs.vanillaforums.com/img/logo.svg" alt="Vanilla Forums" width="102" height="41" />
                <span class="docs-docs-tag">Docs</span>
            </a>
            
        </div>
        
        <div class="column column-8">
            <div class="vertical-group docs-header-tray">
                <div class="docs-header-search js-search">
    <div class="docs-search-wrap">
        <i class="fa fa-search" ></i>
        <input class="docs-search js-search-input" id="docs-search" />
    </div>
    <ul class="docs-search-results js-search-results">
        <a>
            <li>
                <span class="title"></span>
                <span class="tags"></span>
            </li>
        </a>
    </ul>
</div>
                <div class="docs-cta">
    <a href="http://pages.vanillaforums.com/demo-request-vanilla-forums?utm_source=vanilladocs&utm_medium=cta&utm_campaign=demo-request" class="docs-button button-primary button-small">Request a Demo</a>
</div>
            </div>
        </div>

    </div>

</header>

        <div class="docs-title-wrapper">
            <div class="row">
                <div class="column column-3"></div>
                <div id="title" class="column column-9">
                    <div class="docs-title">
    <h1>OAuth</h1>
    
    <div class="docs-page docs-improve">
          <a href="https://github.com/vanilla/docs/edit/master/content/developer/framework/oauth.md"><i class="fa fa-pencil"></i>Improve this document</a>
    </div>
    
</div>
                </div>
            </div>
        </div>


<div class="docs-content">
    <div class="row">
        <div id="nav" class="column column-3">
            <aside id="sidebar">
    <div class="docs-nav nav-collapse">
        
        <ul class="sidebar-menu nav-tier1">




    <li  class=" nest">
        <a href="//docs.vanillaforums.com/developer/backend/">Backend</a>
    </li>
    
    
	    


    <li  class="">
        <a href="//docs.vanillaforums.com/developer/changelog/">Change Log</a>
    </li>
    
    
	    


    <li  class="">
        <a href="//docs.vanillaforums.com/developer/community/">Community</a>
    </li>
    
    
	    


    <li  class=" nest">
        <a href="//docs.vanillaforums.com/developer/configuration/">Configuration</a>
    </li>
    
    
	    


    <li  class=" nest">
        <a href="//docs.vanillaforums.com/developer/contributing/">Contributing</a>
    </li>
    
    
	    


    <li  class="">
        <a href="//docs.vanillaforums.com/developer/data-privacy/">Data privacy</a>
    </li>
    
    
	    


    <li  class="">
        <a href="//docs.vanillaforums.com/developer/tools/">Developer Tools</a>
    </li>
    
    
	    


    <li  class="">
        <a href="//docs.vanillaforums.com/developer/tools/environment/">Environment Setup</a>
    </li>
    
    
	    


    <li  class=" nest">
        <a href="//docs.vanillaforums.com/developer/importing/">Importing</a>
    </li>
    
    
	    


    <li  class="">
        <a href="//docs.vanillaforums.com/developer/installation/">Installation</a>
    </li>
    
    
	    


    <li  class="">
        <a href="//docs.vanillaforums.com/developer/locales/">Locales</a>
    </li>
    
    
	    


    <li  class=" nest">
        <a href="//docs.vanillaforums.com/developer/plugins/">Plugins</a>
    </li>
    
    
	    


    <li  class="">
        <a href="//docs.vanillaforums.com/developer/routes/">Routes</a>
    </li>
    
    
	    


    <li  class="">
        <a href="//docs.vanillaforums.com/developer/schemas/">Schemas</a>
    </li>
    
    
	    


    <li  class=" nest">
        <a href="//docs.vanillaforums.com/developer/theming/">Theming</a>
    </li>
    
    
	    


    <li  class="">
        <a href="//docs.vanillaforums.com/developer/troubleshooting/">Troubleshooting</a>
    </li>
    
    
	    


    <li  class="">
        <a href="//docs.vanillaforums.com/api/">Vanilla API</a>
    </li>
    
    
	    


    <li  class="active nest">
        <a href="//docs.vanillaforums.com/developer/framework/">Framework</a>
    </li>
    
    
        
        
        
        
            <ul class="nav-tier2">
	    
                <li class="">
                    <a href="//docs.vanillaforums.com/developer/framework/assets/">Assets </a>
                </li>
                
                

	    
	    
                <li class="">
                    <a href="//docs.vanillaforums.com/developer/framework/controllers/">Controllers &amp; URLs </a>
                </li>
                
                

	    
	    
                <li class="">
                    <a href="//docs.vanillaforums.com/developer/framework/database/">Database access </a>
                </li>
                
                

	    
	    
                <li class="">
                    <a href="//docs.vanillaforums.com/developer/framework/datasets/">Datasets </a>
                </li>
                
                

	    
	    
                <li class="">
                    <a href="//docs.vanillaforums.com/developer/framework/email/">Email </a>
                </li>
                
                

	    
	    
                <li class="">
                    <a href="//docs.vanillaforums.com/developer/framework/helpers/">Helpers </a>
                </li>
                
                

	    
	    
                <li class="">
                    <a href="//docs.vanillaforums.com/developer/framework/inform/">Inform Messages </a>
                </li>
                
                

	    
	    
                <li class="">
                    <a href="//docs.vanillaforums.com/developer/framework/i18n/">Internationalization &amp; Localization </a>
                </li>
                
                

	    
	    
                <li class="">
                    <a href="//docs.vanillaforums.com/developer/framework/models/">Models, Forms, &amp; Validation </a>
                </li>
                
                

	    
	    
                <li class="">
                    <a href="//docs.vanillaforums.com/developer/framework/modules/">Modules </a>
                </li>
                
                

	    
	    
                <li class="active">
                    <a href="//docs.vanillaforums.com/developer/framework/oauth/">OAuth </a>
                </li>
                
                
                    
                    
               
                    
                

	    
	    
                <li class="">
                    <a href="//docs.vanillaforums.com/developer/framework/permissions/">Permissions </a>
                </li>
                
                

	    
	    
                <li class="">
                    <a href="//docs.vanillaforums.com/developer/framework/requests/">Requests </a>
                </li>
                
                

	    
	    
                <li class="">
                    <a href="//docs.vanillaforums.com/developer/framework/views/">Views </a>
                </li>
                
                

	    
	    
                <li class=" nest">
                    <a href="//docs.vanillaforums.com/developer/framework/apiv2/">Writing APIs </a>
                </li>
                
                

	    </ul>
        
    
	    


    <li  class="">
        <a href="//docs.vanillaforums.com/developer/embedding/">Embedding</a>
    </li>
    
    
	    



        </ul>
        
    </div>
</aside>
        </div>

        <div id="content" class="column column-9">

            

                

<h2 id="sso-with-oauth-overview">SSO with OAuth: Overview</h2>

<p>Vanilla currently provides OAuth2 integrations with these third-party services as ready-to-go addons:</p>

<ul>
<li>Facebook</li>
<li>Twitter</li>
<li>LinkedIn</li>
<li>Google+</li>
</ul>

<p>Because OAuth 2.0 is an SSO <em>framework</em> and not a narrowly defined protocol (see <a href="https://tools.ietf.org/html/rfc6749">OAuth 2.0 Spec</a>), custom services work is typically required to set up an OAuth solution for your forum. In an attempt to minimize the amount of custom services required to create SSO integrations, Vanilla has created a base class that can easily be extended by custom plugins. This base class might look like many of our plugins (containing event handlers, etc.) it is not intended to be executed directly. To take advantage of this class, either use our <strong>OAuth2 Plugin</strong> or <strong>Create Your Own OAuth2 Plugin</strong>.</p>

<h2 id="oauth2-plugin">OAuth2 Plugin</h2>

<h3 id="overview">Overview</h3>

<p>Vanilla has created an OAuth2 plugin that, for most use-cases, can provide a plug-and-play SSO solution.</p>

<p>OAuth2 accounts are mapped to existing forum accounts by email address, or a new account is created if no match is found.</p>

<h3 id="workflow">Workflow</h3>

<p>This plugin has a workflow of three distinct steps:</p>

<ul>
<li>An <strong>authorization request</strong> (request for a code)</li>
<li>A <strong>token request</strong> (the code is exchanged for an authorization token)</li>
<li>A <strong>profile request</strong> (by passing the authoriztion token)</li>
</ul>

<h3 id="assumptions">Assumptions</h3>

<p>Besides requiring that you follow the workflow above, this plugin has several assumptions about the setup of the Authorization Server. If your Authorization Server does not meet these assumptions it does not mean that you cannot integrate with a Vanilla forum, it means that you will not be able to use this plugin out of the box and that you will requires some level of customization.</p>

<ul>
<li>All requests from Vanilla are sent with the header <code>Content-Type: application/x-www-form-urlencoded</code></li>
<li>The Authorization Server will expect an authorization request sent by GET with the following parameters:

<ul>
<li><code>response_type</code> =&gt; <code>code</code></li>
<li><code>client_id</code></li>
<li><code>redirect_uri</code> =&gt; https://<em>[The url of the forum]</em>/entry/oauth2</li>
<li><code>scope</code></li>
<li><code>state</code></li>
</ul></li>
<li>The Authorization Server will respond to a successful log in by sending a <code>code</code> through GET to the <code>redirect_uri</code></li>
<li>The Authorization Server will expect a token request sent by POST with the following parameters:

<ul>
<li><code>code</code> =&gt; <em>[the code returned from the authorization request]</em></li>
<li><code>client_id</code></li>
<li><code>client_secret</code></li>
<li><code>redirect_uri</code> =&gt; https://<em>[The url of the forum]</em>/entry/oauth2</li>
<li><code>grant_type</code> =&gt; <code>authorization_code</code></li>
<li><code>scope</code></li>
</ul></li>
<li>The Authorization Server will send a JSON response with the variable <code>access_token</code></li>
<li>The Authorization Server will accept a request for the user&rsquo;s profile sent by GET with <code>access_token</code></li>
<li>The Authorization Server will send a JSON response with at least the following:

<ul>
<li>A uniqueID for the user</li>
<li>the user&rsquo;s email</li>
<li>the user&rsquo;s name (display name, nickname)</li>
</ul></li>
</ul>

<p><strong>NOTE</strong>: Not supported in this work flow are <strong>&ldquo;nonce&rdquo; support</strong> (a hash sent in the <code>state</code> and verified to be unchanged) and <strong>refresh tokens</strong>.</p>

<h3 id="features">Features</h3>

<p>The OAuth2 Plugin attempts to &ldquo;parameterize&rdquo; as many aspects of the functionality as possible. A settings form in the dashboard allows you to set:</p>

<ul>
<li>The client id</li>
<li>The client secret</li>
<li>The full path to the authorization URI, registration uri, sign out uri, token endpoint and profile endpoint</li>
<li>The scope</li>
<li>The exepected keys in the json response in the profile request</li>
</ul>

<h3 id="possible-pitfalls">Possible Pitfalls</h3>

<p>A number of things can go wrong when trying to implement SSO with this plugin:</p>

<ul>
<li>Double check that all the parameters outlined in the Assumptions section above are met</li>
<li>Your forum must be accessed over <code>https</code> and must contact your Authorization Server in the same way</li>
<li>Your Authorization Server will usually need to &ldquo;whitelist&rdquo; the redirect URI (i.e. https://<em>[The url of the forum]</em>/entry/oauth2)</li>
</ul>

<h2 id="create-your-own-oauth2-plugin">Create Your Own OAuth2 Plugin</h2>

<p>For more on how to create your own plugin see our docs on <a href="//docs.vanillaforums.com/developer/plugins/">Plugins</a>.</p>

<p>Feel free to use the OAuth2 plugin as a template. Make sure your plugin extends Gdn_OAuth2. You may want to change your ProviderKey (the key used to store your configuration data in the db) to something unique:</p>

<p><code>$this-&gt;setProviderKey('myOauthConnection');</code></p>

<p>This key will appear as part of a URL on the public facing site when users connect so you will want to make it relevant, readable and url safe.</p>

<p>Now you can override any of the methods or constants in Gdn_OAuth2 or create new hooks for added functionality.</p>


            
            
        </div>
    </div>
</div>

        
        <div class="docs-platform">
    
    <div class="row">
    
        <div class="column column-3"></div>
        <div class="column column-9">
            <div class="docs-platform-choice choice-cloud">
                
                <img src="//docs.vanillaforums.com/img/cloud-hosting.png" />
                <div class="choice-details">
                    <h3>Cloud Hosting</h3>
                    <p>
                        We believe that online communities should be intuitive, engaging and true to your brand.
                    </p>
                </div>
                <a href="https://vanillaforums.com" class="docs-button button-outline">Learn more</a>
                
            </div>
        </div>

    </div>
    
</div>
        
        <footer class="docs-footer">
    
    <div class="row">
        
        <div class="column column-6">
            <div class="docs-copyright">
    Copyright &copy 2009-2017 Vanilla Forums, Inc. All rights reserved.
</div>
        </div>
        
        <div class="column column-6">
            <div class="docs-links">
    <a class="docs-links-item item-docs" href="http://docs.vanillaforums.com">Documentation</a>
    <a class="docs-links-item item-blog" href="https://blog.vanillaforums.com">Blog</a>
    <a class="docs-links-item item-cloud" href="https://vanillaforums.com">Cloud</a>
    <a class="docs-links-item item-community" href="https://vanillaforums.org/discussions">Community</a>
    <a class="docs-links-item item-api" href="http://docs.vanillaforums.com/api">API</a>
    <a class="docs-links-item item-github" href="https://github.com/vanilla/vanilla">GitHub</a>
    <a class="docs-links-item item-issues" href="https://github.com/vanilla/vanilla/issues">Issues</a>
</div>
        </div>
        
    </div>
</footer>
        
    </body>
    
</html>