<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="description" content="Vanilla Forums, create an online community that your customers will love">
        <meta name="author" content="Vanilla Community">

        <title>Vanilla Forums Documentation</title>
        
        <link href="//docs.vanillaforums.com/css/docs.css" rel="stylesheet">
        <link href="//docs.vanillaforums.com/css/fonts/fontawesome/css/font-awesome.min.css" rel="stylesheet">
        
        <script src="//docs.vanillaforums.com/js/vendor/jquery-3.0.0.min.js"></script>
        <script src="//docs.vanillaforums.com/js/vendor/jquery.store.js"></script>
        <script src="//docs.vanillaforums.com/js/lunr-index.json" id="search-manifest" type="application/json"></script>
        <script src="//docs.vanillaforums.com/js/vendor/lunr.js"></script>
        <script src="//docs.vanillaforums.com/js/search.js"></script>
        
        <link rel="shortcut icon" href="//docs.vanillaforums.com/favicon.ico" type="image/x-icon" />
        <link rel="apple-touch-icon" href="//docs.vanillaforums.com/apple-touch-icon.png" />
        <style type="text/css">
            .callout {
                table-layout: fixed;
            }
        </style>
        
        
<script type="text/javascript">
    (function(i, s, o, g, r, a, m) {
        i['GoogleAnalyticsObject'] = r;
        i[r] = i[r] || function() {
            (i[r].q = i[r].q || []).push(arguments)
        }, i[r].l = 1 * new Date();
        a = s.createElement(o),
                m = s.getElementsByTagName(o)[0];
        a.async = 1;
        a.src = g;
        m.parentNode.insertBefore(a, m)
    })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

    ga('create', 'UA-12713112-1', 'auto');
    ga('require', 'displayfeatures');
    ga('send', 'pageview');
</script>

<script type="text/javascript">
    (function(d, s, i, r) {
        if (d.getElementById(i)) {
            return;
        }
        var n = d.createElement(s), e = d.getElementsByTagName(s)[0];
n.id = i;
        n.src = '//js.hs-analytics.net/analytics/' + (Math.ceil(new Date() / r) * r) + '/95135.js';
        e.parentNode.insertBefore(n, e);
    })(document, "script", "hs-analytics", 300000);
</script>
        
    </head>

    <body class="docs grid docs-layout-single docs-layout-section-developer">
        
        <header class="docs-header">
    
    <div class="row">

        <div class="column column-4">
            
            <a class="vertical-group docs-header-logo" href="//docs.vanillaforums.com/">
                <img class="logo" src="//docs.vanillaforums.com/img/logo.svg" alt="Vanilla Forums" width="102" height="41" />
                <span class="docs-docs-tag">Docs</span>
            </a>
            
        </div>
        
        <div class="column column-8">
            <div class="vertical-group docs-header-tray">
                <div class="docs-header-search js-search">
    <div class="docs-search-wrap">
        <i class="fa fa-search" ></i>
        <input class="docs-search js-search-input" id="docs-search" />
    </div>
    <ul class="docs-search-results js-search-results">
        <a>
            <li>
                <span class="title"></span>
                <span class="tags"></span>
            </li>
        </a>
    </ul>
</div>
                <div class="docs-cta">
    <a href="http://pages.vanillaforums.com/demo-request-vanilla-forums?utm_source=vanilladocs&utm_medium=cta&utm_campaign=demo-request" class="docs-button button-primary button-small">Request a Demo</a>
</div>
            </div>
        </div>

    </div>

</header>
        
        <div class="docs-title-wrapper">
            <div class="row">
                <div class="column column-3"></div>
                <div id="title" class="column column-9">
                    <div class="docs-title">
    <h1>Resource Routing</h1>
    
    <div class="docs-page docs-improve">
          <a href="https://github.com/vanilla/docs/edit/master/content/developer/framework/apiv2/resource-routing.md"><i class="fa fa-pencil"></i>Improve this document</a>
    </div>
    
</div>
                </div>
            </div>
        </div>
        

<div class="docs-content">
    <div class="row">
        <div id="nav" class="column column-3">
            <aside id="sidebar">
    <div class="docs-nav nav-collapse">
        
        <ul class="sidebar-menu nav-tier1">




    <li  class="">
        <a href="//docs.vanillaforums.com/api/">Vanilla API</a>
    </li>
    
    
	    


    <li  class="active nest">
        <a href="//docs.vanillaforums.com/developer/framework/">Framework</a>
    </li>
    
    
        
        
        
        
            <ul class="nav-tier2">
	    
                <li class="">
                    <a href="//docs.vanillaforums.com/developer/framework/assets/">Assets </a>
                </li>
                
                

	    
	    
                <li class="">
                    <a href="//docs.vanillaforums.com/developer/framework/controllers/">Controllers &amp; URLs </a>
                </li>
                
                

	    
	    
                <li class="">
                    <a href="//docs.vanillaforums.com/developer/framework/database/">Database access </a>
                </li>
                
                

	    
	    
                <li class="">
                    <a href="//docs.vanillaforums.com/developer/framework/datasets/">Datasets </a>
                </li>
                
                

	    
	    
                <li class="">
                    <a href="//docs.vanillaforums.com/developer/framework/email/">Email </a>
                </li>
                
                

	    
	    
                <li class="">
                    <a href="//docs.vanillaforums.com/developer/framework/helpers/">Helpers </a>
                </li>
                
                

	    
	    
                <li class="">
                    <a href="//docs.vanillaforums.com/developer/framework/inform/">Inform Messages </a>
                </li>
                
                

	    
	    
                <li class="">
                    <a href="//docs.vanillaforums.com/developer/framework/i18n/">Internationalization &amp; Localization </a>
                </li>
                
                

	    
	    
                <li class="">
                    <a href="//docs.vanillaforums.com/developer/framework/models/">Models, Forms, &amp; Validation </a>
                </li>
                
                

	    
	    
                <li class="">
                    <a href="//docs.vanillaforums.com/developer/framework/modules/">Modules </a>
                </li>
                
                

	    
	    
                <li class="">
                    <a href="//docs.vanillaforums.com/developer/framework/oauth/">OAuth </a>
                </li>
                
                

	    
	    
                <li class="">
                    <a href="//docs.vanillaforums.com/developer/framework/permissions/">Permissions </a>
                </li>
                
                

	    
	    
                <li class="">
                    <a href="//docs.vanillaforums.com/developer/framework/requests/">Requests </a>
                </li>
                
                

	    
	    
                <li class="">
                    <a href="//docs.vanillaforums.com/developer/framework/views/">Views </a>
                </li>
                
                

	    
	    
                <li class="active nest">
                    <a href="//docs.vanillaforums.com/developer/framework/apiv2/">Writing APIs </a>
                </li>
                
                
                    
                    
               
                    
                        <ul class="nav-tier3">

                            <li class="active">
                                <a href="//docs.vanillaforums.com/developer/framework/apiv2/resource-routing/">Resource Routing</a>
                            </li>

                            
                                
                                
                                
                                
			    
		    
                        

                            <li class="">
                                <a href="//docs.vanillaforums.com/developer/framework/apiv2/api-endpoints/">Writing API Endpoints</a>
                            </li>

                            
		    
                        

                            <li class="">
                                <a href="//docs.vanillaforums.com/developer/framework/apiv2/authentication/">Authentication</a>
                            </li>

                            
		    
                        </ul>
                    
                

	    </ul>
        
    
	    


    <li  class="">
        <a href="//docs.vanillaforums.com/developer/embedding/">Embedding</a>
    </li>
    
    
	    


    <li  class="">
        <a href="//docs.vanillaforums.com/developer/backend/">Backend</a>
    </li>
    
    
	    


    <li  class="">
        <a href="//docs.vanillaforums.com/developer/changelog/">Change Log</a>
    </li>
    
    
	    


    <li  class="">
        <a href="//docs.vanillaforums.com/developer/community/">Community</a>
    </li>
    
    
	    


    <li  class=" nest">
        <a href="//docs.vanillaforums.com/developer/configuration/">Configuration</a>
    </li>
    
    
	    


    <li  class=" nest">
        <a href="//docs.vanillaforums.com/developer/contributing/">Contributing</a>
    </li>
    
    
	    


    <li  class="">
        <a href="//docs.vanillaforums.com/developer/data-privacy/">Data privacy</a>
    </li>
    
    
	    


    <li  class="">
        <a href="//docs.vanillaforums.com/developer/tools/">Developer Tools</a>
    </li>
    
    
	    


    <li  class=" nest">
        <a href="//docs.vanillaforums.com/developer/importing/">Importing</a>
    </li>
    
    
	    


    <li  class="">
        <a href="//docs.vanillaforums.com/developer/installation/">Installation</a>
    </li>
    
    
	    


    <li  class="">
        <a href="//docs.vanillaforums.com/developer/locales/">Locales</a>
    </li>
    
    
	    


    <li  class=" nest">
        <a href="//docs.vanillaforums.com/developer/plugins/">Plugins</a>
    </li>
    
    
	    


    <li  class="">
        <a href="//docs.vanillaforums.com/developer/routes/">Routes</a>
    </li>
    
    
	    


    <li  class="">
        <a href="//docs.vanillaforums.com/developer/schemas/">Schemas</a>
    </li>
    
    
	    


    <li  class=" nest">
        <a href="//docs.vanillaforums.com/developer/theming/">Theming</a>
    </li>
    
    
	    


    <li  class="">
        <a href="//docs.vanillaforums.com/developer/troubleshooting/">Troubleshooting</a>
    </li>
    
    
	    



        </ul>
        
    </div>
</aside>
        </div>

        <div id="content" class="column column-9">

            

                

<h2 id="restful-resource-routing-to-controller-methods">RESTful Resource Routing to Controller Methods</h2>

<p>This section tells you how to name your controller objects and methods so that they can be accessed by API requests. By default, all of your controllers are accessed from tha <strong>/api/v2/</strong> base path. After that, the rest of the path and the HTTP method determines what method gets called within your app.</p>

<h2 id="controller-names">Controller Names</h2>

<p>In order for a controller to be accessable from the API its name must end in &ldquo;ApiController&rdquo;. For example if you want to write a controller for the &ldquo;/discussions&rdquo; endpoints you would name it &ldquo;DiscussionsApiController&rdquo;. URLs support dashes. When a dash is encountered it will map to a capital letter in the controller name. For example the &ldquo;/sites-proxy&rdquo; endpoints map to the &ldquo;SitesProxyApiController&rdquo;. Vanilla&rsquo;s addon manager is case-insensitive, but we recommend that you name your classes with proper casing because not all autoloaders are case-insensitive.</p>

<p>In RESTful APIs controllers should be plural. Think of controllers as folders in your file system. Folders contain many files and are usually named with the plural words such as &ldquo;documents&rdquo; or &ldquo;pictures&rdquo;. Always try and name your controllers in a similar way. When working on a project with many people it&rsquo;s important to stick to a common naming convention.</p>

<p>Currently, controllers do not support namespaces, but that is coming soon. When it does the namespace won&rsquo;t matter when routing to the controller so choose your controller names wisely in order to avoid clashes with other controllers.</p>

<h2 id="methods-names-actions">Methods Names (Actions)</h2>

<p>When adding methods (actions) to your controllers their names determine what what type of request they&rsquo;ll map to. Here are the rules that determine which action is called.</p>

<ul>
<li><method>() maps with METHOD /controller (ex. DiscussionsApiController::post() maps with &ldquo;POST /discussions&rdquo;).</li>
<li><method>_name() maps with METHOD /controller/name (ex. ProfileApiController::get_activity() maps with &ldquo;GET /profile/activity&rdquo;).</li>
<li>index() maps with GET /controller.</li>
<li>name() maps with any HTTP method. Try to avoid such global actions.</li>
</ul>

<p>URLs can also contain dashes for method names. They map in much the same way as controller names. Because methods are case-insensitive a URL of /controller/my-comments is equivalent to /controller/mycomments. We may remove these ambiguities in the future so make sure to use proper casing and dashes in your method names and URLs respectively.</p>

<h3 id="http-method-vs-controller-method">HTTP Method vs. Controller Method</h3>

<p>The HTTP method referes to the method of the <em>HTTP request</em>. This is usually one of the following verbs: GET, POST, PATCH, PUT, DELETE, HEAD, and OPTIONS. With object oriented programming, functions declared on a class are also referrred to as methods. It&rsquo;s sometimes confusing trying to differentiate between the two. For this reason we will usually refer to the HTTP methods as methods and the other methods as <strong>actions</strong>.</p>

<h3 id="protected-methods">Protected Methods</h3>

<p>Usually, all public methods can be accessed via. URL. This could present a security concern where you might want a class method to be public, but not accessable via API. There are a couple of ways to protect public controller methods.</p>

<ol>
<li><p>Getters and setters that begin with &ldquo;get&rdquo;, &ldquo;set&rdquo;, or &ldquo;is&rdquo; and are followed by a non-underscore character cannot be accessed by the API. If you want to make such a name accessable (such as &ldquo;settings&rdquo;) you can put an HTTP verb before the name (ex. get_settings).</p></li>

<li><p>If your controller implements an &ldquo;isProtected($name)&rdquo; method then it will be called by the router to check all method names to see if they are public actions.</p></li>
</ol>

<h2 id="parameters">Parameters</h2>

<p>When you add parameters to your methods they get mapped from the URLs path. This is usually how you add a record&rsquo;s ID to your RESTful API. For example, you can map GET /comments/123 to CommentsApiController::get($id).</p>

<p><em>Note: In previous versions of Vanilla&rsquo;s API, method parameters were also mapped from the query string. This is no longer the case so make sure to keep this in mind if you are upgrading older endpoints.</em></p>

<h3 id="parametr-ambiguities">Parametr Ambiguities</h3>

<p>Let&rsquo;s say you&rsquo;ve defined the following methods on your controller:</p>

<pre><code class="language-php">class DiscussionsApiController {
    public function index($page = '') { }

    public function get($id) { }
}
</code></pre>

<p>Looking at the definition you would expect we want something like the following:</p>

<ul>
<li>GET /discussions/p2 maps to DiscussionsApiController::index(&lsquo;p2&rsquo;)</li>
<li>GET /discussions/123 maps to DiscussionsApiController::get(&lsquo;123&rsquo;)</li>
</ul>

<p>The problem is that the router doesn&rsquo;t know which method you want to map to. By default, because the <strong>get()</strong> method takes precedence over <strong>index()</strong> it would get dispatched both times. To avoid these ambiguities there are a few strategies.</p>

<ol>
<li>Use the query string more. In the above example the page should really be a querystring parameter because that&rsquo;s how it&rsquo;s behaving. This is a break from Vanilla&rsquo;s older APIs.</li>
<li>Parameter names can act as constraint. By default Vanilla has a constraint on the <strong>id</strong> parameter where it must contain all digits: perfect for database primary keys. Constraints are regular expressions or callbacks and are added to the routing object. Try to avoid adding constraints yourself though because they are currently global.</li>
<li>Parameter count matters when mappng paths to actions. A path with more or less parts than action parameters will not map to that method. If your action has optional parameters then they aren&rsquo;t required though. A path with less parts will call your action with the remaining default values.</li>
</ol>

<p>If you understand these rules you will be able to overcome most edge cases. However, you should aim to keep your controllers simple. We don&rsquo;t want to see complex action names just because you are worried about name clashes.</p>

<h3 id="parameter-mapping">Parameter Mapping</h3>

<p>Some parameters will be automatically mapped from request data. In order to map request data you can use the following naming convention. Note that the type hints matter (TODO, but this is a good idea).</p>

<ul>
<li><strong>array $query</strong> will receive the query string as an array ($_GET).</li>
<li><strong>array $body</strong> will receive the request body ($_POST).</li>
<li><strong>array $data</strong> will receive a combination of the reflected method parameters, query string, and body. Use this to include the method parameters in a schema check.</li>
<li><strong>Garden\RequestInterface $</strong>* will receive the request object.</li>
<li><strong>&hellip;$</strong>* variadics will receive the rest of the path.</li>
<li><strong>$path</strong> is like the variadic, but will get a string (TODO).</li>
</ul>

<p>Using parameter mapping begins to make controller methods look more like model methods or plain PHP functions. This is intentional and you should keep that theory in mind when writing controller methods. Controller methods should be able to be called without the entire request bootstrapping process.</p>

<h2 id="a-default-restful-resource-conroller">A Default RESTful Resource Conroller</h2>

<p>In general, you want to write your controller to contain mainly the basic HTTP methods. Often this will be all that you need and will provide basic CRUD functionality for a database table. Below is a skeletal /widgets resource illustrating this example.</p>

<pre><code class="language-php">class WidgetsApiController {
    // List and search for widgets.
    public function index(array $query = []) { }

    // Add a widget.
    public function post(array $data) { }

    // Update an existing widget.
    public function patch($id, array $data) { }

    // Delete a widget.
    public function delete($id) { }
}
</code></pre>


            
            
        </div>
    </div>
</div>

        
        <div class="docs-platform">
    
    <div class="row">
    
        <div class="column column-3"></div>
        <div class="column column-9">
            <div class="docs-platform-choice choice-cloud">
                
                <img src="//docs.vanillaforums.com/img/cloud-hosting.png" />
                <div class="choice-details">
                    <h3>Cloud Hosting</h3>
                    <p>
                        We believe that online communities should be intuitive, engaging and true to your brand.
                    </p>
                </div>
                <a href="https://vanillaforums.com" class="docs-button button-outline">Learn more</a>
                
            </div>
        </div>

    </div>
    
</div>
        
        <footer class="docs-footer">
    
    <div class="row">
        
        <div class="column column-6">
            <div class="docs-copyright">
    Copyright &copy 2009-2017 Vanilla Forums, Inc. All rights reserved.
</div>
        </div>
        
        <div class="column column-6">
            <div class="docs-links">
    <a class="docs-links-item item-docs" href="http://docs.vanillaforums.com">Documentation</a>
    <a class="docs-links-item item-blog" href="https://blog.vanillaforums.com">Blog</a>
    <a class="docs-links-item item-cloud" href="https://vanillaforums.com">Cloud</a>
    <a class="docs-links-item item-community" href="https://vanillaforums.org/discussions">Community</a>
    <a class="docs-links-item item-api" href="http://docs.vanillaforums.com/api">API</a>
    <a class="docs-links-item item-github" href="https://github.com/vanilla/vanilla">GitHub</a>
    <a class="docs-links-item item-issues" href="https://github.com/vanilla/vanilla/issues">Issues</a>
</div>
        </div>
        
    </div>
</footer>
        
    </body>
    
</html>